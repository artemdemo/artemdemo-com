<!DOCTYPE html><html lang="en"><head><title>Replacing moment.js with date-fns | Artem Demo</title><link rel="icon" type="image/x-icon" href="/./assets/favicon-dec32dcbac.ico"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="description" content="Blog about web development, indie GameDev"><meta property="og:title" content="Replacing moment.js with date-fns"><meta property="og:description" content="Blog about web development, indie GameDev"><link rel="stylesheet" href="/./assets/code-theme-36bdf5f7fe.css"><link rel="stylesheet" href="/./assets/site.render-5d1535d9c3.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-3BCNZ31TWL"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3BCNZ31TWL');</script></head><body><div><div class="header-wrapper"><div class="container"><div class="header-container"><div class="header-item header-item__logo"><a class="header-logo-link" href="/">Artem Demo &lt;/&gt;</a></div><div class="header-item header-item__menu"><div class="header-item-menu"><div class="top-menu"><div class="top-menu_item top-menu_item__active"><a class="top-menu_link" href="/">Blog</a></div><div class="top-menu_item"><a class="top-menu_link" href="/about/">About</a></div><div class="top-menu_item"><a class="top-menu_link" href="/contact/">Contact me</a></div></div></div></div></div><div class="header-separator"></div></div></div><div class="container"><div class="ContentWrapper"><h1>Replacing moment.js with date-fns</h1><div class="secondary-text">04 November, 2018</div><div class="secondary-text">Tags:Â <a class="post-tags-item" href="/blog/tag/moment.js/">moment.js</a><a class="post-tags-item" href="/blog/tag/date-fns/">date-fns</a></div><p>It&#x27;s known that <a href="https://momentjs.com/">moment.js</a> is a widely used library for date and time manipulations. Obviously it is the case because of the limitations of standard JavaScript API, but today we&#x27;re not going to judge standard language features. Let&#x27;s accept the insufficiency of built-in tools and investigate whether or not I can replace moment.js with a smaller library.</p><p>Addy Osmani <a href="https://youtu.be/i5R7giitymk?t=379">suggested in the recent video</a> called &quot;The State of JavaScript&quot;, using <a href="https://date-fns.org/">date-fns.js</a> as a replacement for moment.js. It&#x27;s not the first time I&#x27;m hearing this advice, so I decided to give it a try and see how easy it will be and how much I gain in this replacement.</p><p>First of all let&#x27;s compare full library size (without localizations), so we will have good starting point:</p><ul><li><a href="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.29.0/date_fns.min.js">date-fns.min.js</a> - 68 Kb</li><li><a href="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js">moment.min.js</a> - 50 Kb</li></ul><p>Interesting - it looks like date-fn.js is bigger than moment.js - so why are so many people recommending it as a smaller replacement for moment?</p><p>The thing is, these sizes are not correct in a real world scenario. I took these libraries from CDN and they include all functionality even though I probably don&#x27;t need all of it. And these functionalities can probably be removed in the build process. So let&#x27;s create a small project and check it.</p><p>Usually I use moment.js for all date/time manipulations, therefore I will base this project on the functionality of this library and then will try to recreate it with date-fns. At the end I will compare bundle size and will see which one is smaller.</p><p>So what will be most used functions (in my case) of moment.js - actually not that many, I can sum them up in one code example:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// moment-example.js</span>
<span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> &#x27;moment&#x27;;
<span class="hljs-keyword">import</span> { timestamp, diffTimestamp, formatStr } <span class="hljs-keyword">from</span> &#x27;../constants&#x27;;

<span class="hljs-keyword">const</span> momentExample = ($el) =&gt; {
  $el.<span class="hljs-title function_">html</span>(
    <span class="hljs-string">`&lt;div&gt;
        &lt;p&gt;Regular: <span class="hljs-subst">${moment(timestamp).format(formatStr)}</span>&lt;/p&gt;
        &lt;p&gt;UTC: <span class="hljs-subst">${moment.utc(timestamp).format(formatStr)}</span>&lt;/p&gt;
        &lt;p&gt;Duration in days: <span class="hljs-subst">${moment.duration(diffTimestamp).asDays()}</span>&lt;/p&gt;
        &lt;p&gt;Duration human readable: <span class="hljs-subst">${moment
          .duration(diffTimestamp)
          .humanize()}</span>&lt;/p&gt;
        &lt;p&gt;Timestamp: <span class="hljs-subst">${moment(timestamp).format(&#x27;x&#x27;)}</span>&lt;/p&gt;
    &lt;/div&gt;`</span>,
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> momentExample;
</span></code></pre><p>Constants will be similar in both examples, therefore I extracted them into a separate file:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// constants.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> timestamp = <span class="hljs-number">1540035262000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> diffTimestamp = <span class="hljs-number">1200000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> formatStr = &#x27;<span class="hljs-attr">HH</span>:<span class="hljs-attr">mm</span>:ss, <span class="hljs-variable constant_">YYYY</span>-<span class="hljs-variable constant_">MM</span>-<span class="hljs-variable constant_">DD</span>&#x27;;
</span></code></pre><p>Not anything unusual, right? Well this is the case for most libraries - there are only a handful methods that are used. All others are there only for edge cases and for real hardcore developers. So let&#x27;s see what I&#x27;m using here:</p><ul><li><code class="hljs"><span class="hljs">format()</span></code> - obviously one of the most used method of any library that help deal with date/time representations.</li><li><code class="hljs"><span class="hljs">utc()</span></code> - in some cases (especially for tests) I want to be sure that time is presented in UTC.</li><li><code class="hljs"><span class="hljs">duration()</span></code> - how much time was spent on something.</li><li><code class="hljs"><span class="hljs">humanize()</span></code> - useful in charts of time spending representation.</li></ul><p>This is pretty much it, as I said - not anything unusual.</p><p>Let&#x27;s see what can be done with date-fns.</p><p><strong>format()</strong></p><p>First of all formatting - this one is easy. There is a specific function that helps with this one:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-keyword">import</span> { format } <span class="hljs-keyword">from</span> &#x27;date-fns&#x27;;
<span class="hljs-title function_">format</span>(timestamp, formatStr);
</span></code></pre><p>But there is the problem with returning it in UTC. There is no built-in method for it. The authors are saying that they are working on a solution, but it will take time. Currently we can use a workaround that I found in issues on their repo:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">/**
 * Convert given date to UTC
 * <span class="hljs-doctag">@link</span> https://github.com/date-fns/date-fns/issues/556#issuecomment-391048347
 * <span class="hljs-doctag">@param</span> date | plain JS date object
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Date | *</span>}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">toUTC</span>(<span class="hljs-params">date</span>) {
  <span class="hljs-keyword">const</span> offset = date.<span class="hljs-title function_">getTimezoneOffset</span>();

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sign</span>(offset) !== -<span class="hljs-number">1</span>
    ? <span class="hljs-title function_">addMinutes</span>(date, offset)
    : <span class="hljs-title function_">subMinutes</span>(date, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(offset));
}
</span></code></pre><p>And this function will help us to print the date in UTC:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-title function_">format</span>(+<span class="hljs-title function_">toUTC</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(timestamp)), formatStr);
</span></code></pre><p><strong>duration()</strong></p><p>There is a built-in function for this kind of manipulation:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-keyword">import</span> { differenceInDays } <span class="hljs-keyword">from</span> &#x27;date-fns&#x27;;
<span class="hljs-title function_">differenceInDays</span>(diffTimestamp, <span class="hljs-number">0</span>);
</span></code></pre><p><code class="hljs"><span class="hljs">differenceInDays</span></code> will return the difference between 2 dates. In the example above it will return the amount of days in a given timestamp.</p><p>But there is a catch, <code class="hljs"><span class="hljs">differenceInDays</span></code> is returning a result in full days, when <code class="hljs"><span class="hljs">duration()</span></code> from moment.js will return a fraction. This is inconvenient I know, but in my case, not a problem at all.</p><p><strong>humanize()</strong></p><p>In case we need to print duration in human readable format we can use <code class="hljs"><span class="hljs">distanceInWords</span></code>.</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-keyword">import</span> { distanceInWords } <span class="hljs-keyword">from</span> &#x27;date-fns&#x27;;
<span class="hljs-title function_">distanceInWords</span>(diffTimestamp, <span class="hljs-number">0</span>);
</span></code></pre><p>Works exactly like <code class="hljs"><span class="hljs">humanize()</span></code>, very conveniently.</p><p>Now, let&#x27;s see the full example of all methods we used in one piece:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-keyword">import</span> { format, differenceInDays, distanceInWords } <span class="hljs-keyword">from</span> &#x27;date-fns&#x27;;
<span class="hljs-keyword">import</span> { timestamp, diffTimestamp, formatStr } <span class="hljs-keyword">from</span> &#x27;../constants&#x27;;
<span class="hljs-keyword">import</span> { toUTC } <span class="hljs-keyword">from</span> &#x27;../utils&#x27;;

<span class="hljs-keyword">const</span> dateFnsExample = ($el) =&gt; {
  $el.<span class="hljs-title function_">html</span>(
    <span class="hljs-string">`&lt;div&gt;
        &lt;p&gt;Regular: <span class="hljs-subst">${format(timestamp, formatStr)}</span>&lt;/p&gt;
        &lt;p&gt;UTC: <span class="hljs-subst">${format(+toUTC(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(timestamp)), formatStr)}</span>&lt;/p&gt;
        &lt;p&gt;Duration in days: <span class="hljs-subst">${differenceInDays(
          diffTimestamp,
          <span class="hljs-number">0</span>,
        )}</span> (provides difference in &lt;strong&gt;full&lt;/strong&gt; days)&lt;/p&gt;
        &lt;p&gt;Duration human readable: <span class="hljs-subst">${distanceInWords(diffTimestamp, <span class="hljs-number">0</span>)}</span>&lt;/p&gt;
        &lt;p&gt;Timestamp: <span class="hljs-subst">${format(timestamp, &#x27;x&#x27;)}</span>&lt;/p&gt;
    &lt;/div&gt;`</span>,
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> dateFnsExample;
</span></code></pre><p>Now let&#x27;s talk ~~money~~ bits. After uglification and tree-shaking, these are the results:</p><ul><li>Chunk with date-fns.js - 29.3 Kb</li><li>Chunk with moment.js - 57.1 Kb</li></ul><p>Build with moment.js is twice as big as with date-fns. Pretty impressive. Looks like it&#x27;s worth a try.</p><p>By the way, the whole code is in my github account. You can check sizes by yourself as well as see all code examples: <a href="https://github.com/artemdemo/date-fns-vs-moment">https://github.com/artemdemo/date-fns-vs-moment</a></p></div></div></div></body></html>