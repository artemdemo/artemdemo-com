<!DOCTYPE html><html lang="en"><head><title>How to mock components with jest | Artem Demo</title><link rel="icon" type="image/x-icon" href="/./assets/favicon-dec32dcbac.ico"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="description" content="Blog about web development, indie GameDev"><meta property="og:title" content="How to mock components with jest"><meta property="og:description" content="Blog about web development, indie GameDev"><link rel="stylesheet" href="/./assets/code-theme-36bdf5f7fe.css"><link rel="stylesheet" href="/./assets/site.render-5d1535d9c3.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-3BCNZ31TWL"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3BCNZ31TWL');</script></head><body><div><div class="header-wrapper"><div class="container"><div class="header-container"><div class="header-item header-item__logo"><a class="header-logo-link" href="/">Artem Demo &lt;/&gt;</a></div><div class="header-item header-item__menu"><div class="header-item-menu"><div class="top-menu"><div class="top-menu_item top-menu_item__active"><a class="top-menu_link" href="/">Blog</a></div><div class="top-menu_item"><a class="top-menu_link" href="/about/">About</a></div><div class="top-menu_item"><a class="top-menu_link" href="/contact/">Contact me</a></div></div></div></div></div><div class="header-separator"></div></div></div><div class="container"><div class="ContentWrapper"><h1>How to mock components with jest</h1><div class="secondary-text">03 May, 2019</div><div class="secondary-text">Tags:Â <a class="post-tags-item" href="/blog/tag/jest/">jest</a><a class="post-tags-item" href="/blog/tag/test/">test</a><a class="post-tags-item" href="/blog/tag/mocks/">mocks</a></div><p>I have already written a post about <a href="https://artemdemo.com/blog/20181105-test-code-with-momentjs/">mocking moment.js for tests</a>. Today let&#x27;s talk about how to use mocks in a specific tests framework - <a href="https://jestjs.io/">Jest</a>. Jest was developed by Facebook and was based on another tests library called Jasmine. It meant that Jest used widely popular test syntax and could be adapted very easily.</p><p>The main reason why Facebook decided to write its own tests framework was to create a good tool that would serve it&#x27;s main UI framework - React. Therefore Jest had specific methods that were suited to testing React components. I won&#x27;t talk about it in this post since Jest is well suited for testing any javascript code.</p><p>First, we need to define the problem that we&#x27;re facing. Let&#x27;s say we have some class that we need to test (this is the whole goal of this post, right?):</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> &#x27;react&#x27;;
<span class="hljs-keyword">import</span> { format } <span class="hljs-keyword">from</span> &#x27;date-fns&#x27;;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> &#x27;prop-types&#x27;;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DateComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.PureComponent</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> { timeStamp, formatStr } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;
    <span class="hljs-keyword">return</span> &lt;div&gt;{<span class="hljs-title function_">format</span>(timeStamp, formatStr)}&lt;/div&gt;;
  }
}

<span class="hljs-title class_">SomeClass</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">timeStamp</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">number</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">formatStr</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>,
};

<span class="hljs-title class_">SomeClass</span>.<span class="hljs-property">defaultProps</span> = {
  <span class="hljs-attr">formatStr</span>: &#x27;<span class="hljs-attr">HH</span>:<span class="hljs-attr">mm</span>:ss, <span class="hljs-variable constant_">YYYY</span>-<span class="hljs-variable constant_">MM</span>-<span class="hljs-variable constant_">DD</span>&#x27;,
};
</span></code></pre><p>First of all, if you say, that this call can be a function, you&#x27;ll be right. I just want to define it as a class for now. But good catch, I already like you!</p><p>So, what do we have here? DateComponent is a very simple component that takes 2 properties: timeStamp and formatStr. When the first one is required and the second is optional, that means it has a default value. This is obvious enough, so let&#x27;s continue. In the render method, we&#x27;re displaying timeStamp in the defined format. Nothing fancy, pretty basic stuff.</p><p>In the previous post, we already talked about <a href="https://artemdemo.com/blog/20181105-test-code-with-momentjs/">how to test code that uses moment.js</a> - this one is very similar, we just need to mock date-fns, so let&#x27;s write the solution right away:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// __mocks__/date-fns.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> format = (date, formatStr) =&gt; <span class="hljs-string">`<span class="hljs-subst">${+date}</span> [<span class="hljs-subst">${formatStr}</span>]`</span>;

<span class="hljs-comment">// __tests__/DateComponent.test.jsx</span>
<span class="hljs-keyword">import</span> renderer <span class="hljs-keyword">from</span> &#x27;react-test-renderer&#x27;;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DateComponent</span> <span class="hljs-keyword">from</span> &#x27;../<span class="hljs-title class_">DateComponent</span>&#x27;;

jest.<span class="hljs-title function_">mock</span>(&#x27;date-fns&#x27;);

<span class="hljs-keyword">const</span> timeStamp = <span class="hljs-number">1540035262000</span>;

<span class="hljs-title function_">describe</span>(&#x27;<span class="hljs-title class_">DateComponent</span>&#x27;, () =&gt; {
  <span class="hljs-title function_">it</span>(&#x27;should render <span class="hljs-keyword">with</span> <span class="hljs-keyword">default</span> format&#x27;, () =&gt; {
    <span class="hljs-keyword">const</span> tree = renderer
      .<span class="hljs-title function_">create</span>(&lt;<span class="hljs-title class_">DateComponent</span> timeStamp={timeStamp} /&gt;)
      .<span class="hljs-title function_">toJSON</span>();

    <span class="hljs-title function_">expect</span>(tree).<span class="hljs-title function_">toMatchSnapshot</span>();
  });

  <span class="hljs-title function_">it</span>(&#x27;should render <span class="hljs-keyword">with</span> custom format&#x27;, () =&gt; {
    <span class="hljs-keyword">const</span> tree = renderer
      .<span class="hljs-title function_">create</span>(&lt;<span class="hljs-title class_">DateComponent</span> timeStamp={timeStamp} formatStr=&quot;<span class="hljs-variable constant_">YYYY</span>/<span class="hljs-variable constant_">MM</span>/<span class="hljs-variable constant_">DD</span>&quot; /&gt;)
      .<span class="hljs-title function_">toJSON</span>();

    <span class="hljs-title function_">expect</span>(tree).<span class="hljs-title function_">toMatchSnapshot</span>();
  });
});
</span></code></pre><p>Ok, that&#x27;s was easy. Now, let&#x27;s start using <code class="hljs"><span class="hljs">DateComponent</span></code> somewhere. In this case, we&#x27;ll need to mock it too. The reason is simple - each unit test should test only one component, not all of them, including all dependencies, but only one specific component.</p><p>Let&#x27;s say we have <code class="hljs"><span class="hljs">ViewComponent</span></code> component that is using <code class="hljs"><span class="hljs">DateComponent</span></code> in some places. If I will write a test for <code class="hljs"><span class="hljs">ViewComponent</span></code> in a straight forward way, without mocking <code class="hljs"><span class="hljs">DateComponent</span></code>, I will be testing not only <code class="hljs"><span class="hljs">ViewComponent</span></code>, but also all his children, which is undesirable.</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// ViewComponent.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> &#x27;react&#x27;;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DateComponent</span> <span class="hljs-keyword">from</span> &#x27;../<span class="hljs-title class_">DateComponent</span>&#x27;;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ViewComponent</span> = () =&gt; {
  <span class="hljs-keyword">const</span> startTimestamp = <span class="hljs-number">1540035262000</span>;
  <span class="hljs-keyword">const</span> endTimestamp = <span class="hljs-number">1540036000000</span>;
  <span class="hljs-keyword">return</span> (
    &lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">Fragment</span>&gt;
      &lt;p&gt;
        <span class="hljs-title class_">Start</span> <span class="hljs-attr">date</span>: &lt;<span class="hljs-title class_">DateComponent</span> timeStamp={startTimestamp} /&gt;
      &lt;/p&gt;
      &lt;p&gt;
        <span class="hljs-title class_">End</span> <span class="hljs-attr">date</span>: &lt;<span class="hljs-title class_">DateComponent</span> timeStamp={endTimestamp} /&gt;
      &lt;/p&gt;
    &lt;/<span class="hljs-title class_">React</span>.<span class="hljs-property">Fragment</span>&gt;
  );
};
</span></code></pre><p>Therefore we&#x27;ll need to add mocks for <code class="hljs"><span class="hljs">DateComponent</span></code>, so we can test <code class="hljs"><span class="hljs">ViewComponent</span></code> disconnected from its child components. This mock file will need to be added in the same directory where <code class="hljs"><span class="hljs">DateComponent</span></code> is stored and should be placed in <code class="hljs"><span class="hljs">__mocks__</span></code> directory:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// __mocks__/DateComponent.test.jsx</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> &#x27;react&#x27;;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DateComponent</span> = (props) =&gt; (
  &lt;div data-mock=&quot;<span class="hljs-title class_">DateComponent</span>&quot;&gt;<span class="hljs-attr">timeStamp</span>: {props.<span class="hljs-property">timeStamp</span>}&lt;/div&gt;
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DateComponent</span>;
</span></code></pre><p>As you can see above - there is no logic in the mocked component. The whole point is to display the incoming data and we need it only to test how the parent component is using the public API of the DateComponent.</p><p>The final step will be to create a test for <code class="hljs"><span class="hljs">ViewComponent</span></code> itself:</p><pre><code class="language-javascript hljs"><span class="hljs"><span class="hljs-comment">// __tests__/ViewComponent.test.jsx</span>
<span class="hljs-keyword">import</span> renderer <span class="hljs-keyword">from</span> &#x27;react-test-renderer&#x27;;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ViewComponent</span> <span class="hljs-keyword">from</span> &#x27;../<span class="hljs-title class_">ViewComponent</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-title class_">ViewComponent</span>, () =&gt; {
  <span class="hljs-title function_">it</span>(&#x27;should render without data&#x27;, () =&gt; {
    <span class="hljs-keyword">const</span> tree = renderer.<span class="hljs-title function_">create</span>(
      &lt;<span class="hljs-title class_">ViewComponent</span> /&gt;
    ).<span class="hljs-title function_">toJSON</span>();

    <span class="hljs-title function_">expect</span>(tree).<span class="hljs-title function_">toMatchSnapshot</span>();
  });
});
</span></code></pre></div></div></div></body></html>