{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/20181104-replacing-momentjs/","webpackCompilationHash":"2f8690f1cb4fd5239abc","result":{"data":{"site":{"siteMetadata":{"title":"Artem Demo, web dev","author":"Artem Demo"}},"markdownRemark":{"id":"9fe5d175-ac90-5e6e-bace-fa164722eaed","excerpt":"It’s known that moment.js is a widely used library for date and time manipulations.\nObviously it is the case because of the limitations of…","html":"<p>It’s known that <a href=\"https://momentjs.com/\">moment.js</a> is a widely used library for date and time manipulations.\nObviously it is the case because of the limitations of standard JavaScript API,\nbut today we’re not going to judge standard language features.\nLet’s accept the insufficiency of built-in tools and\ninvestigate whether or not I can replace moment.js with a smaller library.</p>\n<p>Addy Osmani <a href=\"https://youtu.be/i5R7giitymk?t=379\">suggested in the recent video</a> called “The State of JavaScript”,\nusing <a href=\"https://date-fns.org/\">date-fns.js</a> as a replacement for moment.js.\nIt’s not the first time I’m hearing this advice,\nso I decided to give it a try and see how easy it will be and how much I gain in this replacement.</p>\n<p>First of all let’s compare full library size (without localizations), so we will have good starting point:</p>\n<ul>\n<li><a href=\"https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.29.0/date_fns.min.js\">date-fns.min.js</a> - 68 Kb</li>\n<li><a href=\"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js\">moment.min.js</a> - 50 Kb</li>\n</ul>\n<p>Interesting - it looks like date-fn.js is bigger than moment.js -\nso why are so many people recommending it as a smaller replacement for moment?</p>\n<p>The thing is, these sizes are not correct in a real world scenario.\nI took these libraries from CDN and they include all functionality even though I probably don’t need all of it.\nAnd these functionalities can probably be removed in the build process. So let’s create a small project and check it.</p>\n<p>Usually I use moment.js for all date/time manipulations,\ntherefore I will base this project on the functionality of this library and then will try to recreate it with date-fns.\nAt the end I will compare bundle size and will see which one is smaller.</p>\n<p>So what will be most used functions (in my case) of moment.js - actually not that many,\nI can sum them up in one code example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// moment-example.js</span>\n<span class=\"token keyword\">import</span> moment <span class=\"token keyword\">from</span> <span class=\"token string\">'moment'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> timestamp<span class=\"token punctuation\">,</span> diffTimestamp<span class=\"token punctuation\">,</span> formatStr <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../constants'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">momentExample</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    $el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div>\n            &lt;p>Regular: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>formatStr<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>UTC: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>moment<span class=\"token punctuation\">.</span><span class=\"token function\">utc</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>formatStr<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>Duration in days: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>moment<span class=\"token punctuation\">.</span><span class=\"token function\">duration</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">asDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>Duration human readable: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>moment<span class=\"token punctuation\">.</span><span class=\"token function\">duration</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">humanize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>Timestamp: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n        &lt;/div></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> momentExample<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Constants will be similar in both examples, therefore I extracted them into a separate file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// constants.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> timestamp <span class=\"token operator\">=</span> <span class=\"token number\">1540035262000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> diffTimestamp <span class=\"token operator\">=</span> <span class=\"token number\">1200000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> formatStr <span class=\"token operator\">=</span> <span class=\"token string\">'HH:mm:ss, YYYY-MM-DD'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Not anything unusual, right?\nWell this is the case for most libraries - there are only a handful methods that are used.\nAll others are there only for edge cases and for real hardcore developers.\nSo let’s see what I’m using here:</p>\n<ul>\n<li><code class=\"language-text\">format()</code> - obviously one of the most used method of any library that help deal with date/time representations.</li>\n<li><code class=\"language-text\">utc()</code> - in some cases (especially for tests) I want to be sure that time is presented in UTC.</li>\n<li><code class=\"language-text\">duration()</code> - how much time was spent on something.</li>\n<li><code class=\"language-text\">humanize()</code> - useful in charts of time spending representation.</li>\n</ul>\n<p>This is pretty much it, as I said - not anything unusual.</p>\n<p>Let’s see what can be done with date-fns.</p>\n<p><strong>format()</strong></p>\n<p>First of all formatting - this one is easy. There is a specific function that helps with this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> format <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns'</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">format</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> formatStr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>But there is the problem with returning it in UTC.\nThere is no built-in method for it. The authors are saying that they are working on a solution,\nbut it will take time. Currently we can use a workaround that I found in issues on their repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * Convert given date to UTC\n * @link https://github.com/date-fns/date-fns/issues/556#issuecomment-391048347\n * @param date | plain JS date object\n * @return {Date | *}\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">toUTC</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">date</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> offset <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getTimezoneOffset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token function\">addMinutes</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">subMinutes</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And this function will help us to print the date in UTC:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token function\">toUTC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formatStr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>duration()</strong></p>\n<p>There is a built-in function for this kind of manipulation:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> differenceInDays <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns'</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">differenceInDays</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">differenceInDays</code> will return the difference between 2 dates.\nIn the example above it will return the amount of days in a given timestamp.</p>\n<p>But there is a catch, <code class=\"language-text\">differenceInDays</code> is returning a result in full days,\nwhen <code class=\"language-text\">duration()</code> from moment.js will return a fraction.\nThis is inconvenient I know, but in my case, not a problem at all.</p>\n<p><strong>humanize()</strong></p>\n<p>In case we need to print duration in human readable format we can use <code class=\"language-text\">distanceInWords</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> distanceInWords <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns'</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">distanceInWords</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Works exactly like <code class=\"language-text\">humanize()</code>, very conveniently.</p>\n<p>Now, let’s see the full example of all methods we used in one piece:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> format<span class=\"token punctuation\">,</span> differenceInDays<span class=\"token punctuation\">,</span> distanceInWords <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> timestamp<span class=\"token punctuation\">,</span> diffTimestamp<span class=\"token punctuation\">,</span> formatStr <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../constants'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> toUTC <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../utils'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">dateFnsExample</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    $el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div>\n            &lt;p>Regular: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> formatStr<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>UTC: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token function\">toUTC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formatStr<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>Duration in days: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">differenceInDays</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (provides difference in &lt;strong>full&lt;/strong> days)&lt;/p>\n            &lt;p>Duration human readable: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">distanceInWords</span><span class=\"token punctuation\">(</span>diffTimestamp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n            &lt;p>Timestamp: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n        &lt;/div></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> dateFnsExample<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now let’s talk <del>money</del> bits. After uglification and tree-shaking, these are the results:</p>\n<ul>\n<li>Chunk with date-fns.js - 29.3 Kb</li>\n<li>Chunk with moment.js - 57.1 Kb</li>\n</ul>\n<p>Build with moment.js is twice as big as with date-fns. Pretty impressive. Looks like it’s worth a try.</p>\n<p>By the way, the whole code is in my github account.\nYou can check sizes by yourself as well as see all code examples: <a href=\"https://github.com/artemdemo/date-fns-vs-moment\">https://github.com/artemdemo/date-fns-vs-moment</a> </p>","frontmatter":{"title":"Replacing moment.js with date-fns","date":"November 04, 2018","tags":["moment.js","date-fns"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/20181104-replacing-momentjs/","previous":{"fields":{"slug":"/20181103-default-collection-sorting/"},"frontmatter":{"title":"Where the default sorting of a collection should be done","tags":["sorting","collections","order"]}},"next":{"fields":{"slug":"/20181105-test-code-with-momentjs/"},"frontmatter":{"title":"How to test code that uses moment.js","tags":["moment.js","test","mocks"]}}}}}