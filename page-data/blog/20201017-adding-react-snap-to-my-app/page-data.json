{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/20201017-adding-react-snap-to-my-app/","result":{"data":{"site":{"siteMetadata":{"title":"Artem Demo, indie developer","author":"Artem Demo"}},"markdownRemark":{"id":"08cd2439-3b8b-5f5f-8cf0-7300f67e801e","excerpt":"I started to experiment with react-snap - a nice tool for creating pre rendered html of your SPA.\nThe reason is fairly simple - I want to…","html":"<p>I started to experiment with <a href=\"https://github.com/stereobooster/react-snap\">react-snap</a> - a nice tool for creating pre rendered html of your SPA.\nThe reason is fairly simple - I want to increase visibility of <a href=\"https://imgreview.app/\">ImgReview</a> by search engines.</p>\n<p>The installation is very easy.\nBasically you need to install the package npm install react-snap, and then just change your app render point to:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> rootElement <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rootElement<span class=\"token punctuation\">.</span><span class=\"token function\">hasChildNodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">hydrate</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> rootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> rootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In my case though there was a problem. Pre render failed with this weird error message: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pageerror at /: SyntaxError: Unexpected token &#39;&lt;&#39;</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 552px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d04869e4055b1c8467099a63ef4e7c98/94ab4/react-snap-unexpected-token-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.945945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVQY02WPSRaCMBBEOQ+CA2DAEBISBUEccHhuvP85yu64cFr8V9WddFIdCLVFO9zR7G5eRdlC2T30+oiV7pHTOdfszeaEuhl9XbmD99LsqH+k+wekxRpBllsUuvMDrFFSYZpqTDPtNaY6Tl/+1TdvT0zmJaKF8rAPel1C0kOuv0LWA6QdsFQtTENptmfSETl95roLLFFRGu7zvbmwCGfyiyB8FEikg6EVl7KBYGhtjp/k7m/gF071yRMZnYfd2gnInAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"React snap unexpected token error\"\n        title=\"React snap unexpected token error\"\n        src=\"/static/d04869e4055b1c8467099a63ef4e7c98/94ab4/react-snap-unexpected-token-error.png\"\n        srcset=\"/static/d04869e4055b1c8467099a63ef4e7c98/3c361/react-snap-unexpected-token-error.png 148w,\n/static/d04869e4055b1c8467099a63ef4e7c98/03654/react-snap-unexpected-token-error.png 295w,\n/static/d04869e4055b1c8467099a63ef4e7c98/94ab4/react-snap-unexpected-token-error.png 552w\"\n        sizes=\"(max-width: 552px) 100vw, 552px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Which wasn’t informative for me, since I had no idea what exactly is causing it (at first).\nAnd then it hit me - this is an error from the browser.\nIt’s just loading wrong files, because it’s not using correct <code class=\"language-text\">index.html</code> file.</p>\n<p>React-snap is running headless chrome under the hood, this is how it creates pre rendered html.\nWhen there is an error during it, the only place to show it is in your terminal.\nSo you need to look at it as you’re checking debug tools of Chrome.</p>\n<p>So the problem was with the <code class=\"language-text\">index.html</code> file of the app.\nIn my case I’m placing it outside of the <code class=\"language-text\">/build</code> folder, so I need somehow to change the source folder for react-snap.\nIt took sometime to figure out the right configuration, since they don’t have good documentation, but eventually I found the solution:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// package.json\n\n&quot;reactSnap&quot; : {\n    &quot;source&quot; : &quot;./&quot;\n},</code></pre></div>\n<p>The cool part about “react-snap” is that it doesn’t need much configuration.\nEven if you use routing, it’s not a problem - all your routes will be rendered into html.</p>","frontmatter":{"title":"Adding react-snap to my app","date":"October 17, 2020","tags":["react-snap","prerender","imgreview"]}}},"pageContext":{"slug":"/20201017-adding-react-snap-to-my-app/","previous":{"fields":{"slug":"/20201012-how-to-use-konva-with-rough-js/"},"frontmatter":{"title":"How to use Konva with Rough.js","tags":["konva","rough.js","imgreview"]}},"next":{"fields":{"slug":"/20201024-simple-template-engine-in-js/"},"frontmatter":{"title":"Simple template engine in JavaScript","tags":["regex","template"]}}}},"staticQueryHashes":[]}